function ShiftAutomation() {
  // â­ï¸å¤‰æ•°ã®å®šç¾©
  const ss = SpreadsheetApp.getActiveSpreadsheet();  //ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚¢ãƒ—ãƒªã‚’å‘¼ã³å‡ºã—ã¦ã€ç¾åœ¨ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—

  //[ã‚·ãƒ¼ãƒˆ]ã‚¹ã‚¿ãƒƒãƒ•åç°¿
  const staffRegister = ss.getSheetByName("ã‚¹ã‚¿ãƒƒãƒ•åç°¿"); //ã‚¹ã‚¿ãƒƒãƒ•åç°¿ã‚·ãƒ¼ãƒˆã‚’å–å¾—
  //ã‚¹ã‚¿ãƒƒãƒ•åç°¿ã®å€¤ã‚’å–å¾—
  const staffsData = staffRegister.getRange(2, 1, staffRegister.getLastRow() - 1, staffRegister.getLastColumn()).getValues();
  //ã‚«ãƒ©ãƒ ã®å®šç¾©
  const staffCols = staffRegister.getRange(1, 1, 1, staffRegister.getLastColumn()).getValues().flat();
  const jobCol = staffCols.indexOf("è·ç¨®");
  const nurseJob = "çœ‹è­·å¸«"
  const employeeTypeCol = staffCols.indexOf("é›‡ç”¨å½¢æ…‹");
  const namecol = staffCols.indexOf("æ°å");
  const nurses = staffsData.filter(row => row[jobCol] == nurseJob);//çœ‹è­·å¸«åç°¿
  const others = staffsData.filter(row => row[jobCol] != nurseJob);//çœ‹è­·å¸«ä»¥å¤–åç°¿

  //[ã‚·ãƒ¼ãƒˆ]å¸Œæœ›ä¼‘
  const dayOffSheet = ss.getSheetByName("å¸Œæœ›ä¼‘å…¥åŠ›ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"); //ç¾å ´ãŒå…¥åŠ›ã™ã‚‹ã‚·ãƒ¼ãƒˆã‚’å–å¾—
  const shiftYear = dayOffSheet.getRange(1, 1).getValue(); //å¸Œæœ›ä¼‘ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚ã‚‹ã€€å¹´ã€€ã‚’å–å¾—
  const shiftMonth = dayOffSheet.getRange(1, 6).getValue();//å¸Œæœ›ä¼‘ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚ã‚‹ã€€æœˆã€€ã‚’å–å¾—
  const eoMonth = new Date(shiftYear, shiftMonth, 0).getDate();     //å¸Œæœ›ä¼‘ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚ã‚‹ã€€æœˆæœ«æ—¥ã€€ã‚’å–å¾—

  //[ã‚·ãƒ¼ãƒˆ]å‹¤å‹™æ¡ä»¶è¨­å®š
  const workSettingSheet = ss.getSheetByName("å‹¤å‹™è¨­å®š");
  const settingRowDatas = workSettingSheet.getRange(1, 1, workSettingSheet.getLastRow(), 1).getValues().flat();
  const requiredDayStaffsRow = settingRowDatas.indexOf("æ—¥å‹¤ã‚¹ã‚¿ãƒƒãƒ•æ•°");
  const requiredDayStaffs = workSettingSheet.getRange(requiredDayStaffsRow + 1, 2).getValue();
  const requiredNightStaffsRow = settingRowDatas.indexOf("å¤œå‹¤ã‚¹ã‚¿ãƒƒãƒ•æ•°");
  const requiredNightStaffs = workSettingSheet.getRange(requiredNightStaffsRow + 1, 2).getValue();
  const number0fDayNursesRow = settingRowDatas.indexOf("æ—¥å‹¤çœ‹è­·å¸«æœ€ä½äººæ•°");
  const requiredDayNurses = workSettingSheet.getRange(number0fDayNursesRow + 1, 2).getValue();
  const number0fNightNursesRow = settingRowDatas.indexOf("å¤œå‹¤çœ‹è­·å¸«æœ€ä½äººæ•°");
  const requiredNightNurses = workSettingSheet.getRange(number0fNightNursesRow + 1, 2).getValue();
  const continuousWorkRow = settingRowDatas.indexOf("é€£å‹¤ä¸Šé™");
  const continuousWork = workSettingSheet.getRange(continuousWorkRow + 1, 2).getValue();
  const limitoverWorkDay = continuousWork + 1//é€£å‹¤ä¸Šé™ã®ãƒ«ãƒ¼ãƒ—æ™‚ä½¿ç”¨
  const monthlyDayOffRow = settingRowDatas.indexOf("æœˆé–“ä¼‘æš‡æ—¥æ•°");
  const monthlyDayOff = workSettingSheet.getRange(monthlyDayOffRow + 1, 2).getValue();
  const nightShiftIntervalRow = settingRowDatas.indexOf("å¤œå‹¤æœ€çŸ­é–“éš”"); //é€£å‹¤ä¸Šé™
  const nightShiftInterval = workSettingSheet.getRange(nightShiftIntervalRow + 1, 2).getValue();

  //[ã‚·ãƒ¼ãƒˆ]é›‡ç”¨å½¢æ…‹
  const onlyDayShift = "æ—¥å‹¤å°‚å¾“"
  const onlyNightShift = "å¤œå‹¤å°‚å¾“"

  //[ã‚·ãƒ¼ãƒˆ]ã‚·ãƒ•ãƒˆå
  const nikkin = "æ—¥";
  const yakin = "å¤œ";
  const ake = "æ˜";
  const kibokyu = "å¸Œ";
  const yukyu = "æœ‰";
  const kakikyu = "å¤";
  const toukikyu = "å†¬";
  const yasumi = "ä¼‘";
  const akeyasu = "æ˜ä¼‘"
  const workday = [nikkin, yakin];
  const dayOff = [yasumi, kibokyu, akeyasu];
  const dayOffForYakin = [yasumi, kibokyu];
  const asatteyasumi = [null, kibokyu];

  //ãƒ©ãƒ³ãƒ€ãƒ ãƒ¡ã‚½ãƒƒãƒ‰ã§ä½¿ã†ç›´è¿‘ï¼‘é€±é–“å‹¤å‹™æ•°ã«å¿œã˜ãŸé…åˆ—
  const probablityShift = [100, 98, 95, 93, 85, 10, 5];

  //ãŸã ã®ãƒ†ã‚¹ãƒˆã€‚ã¡ã‚ƒã‚“ã¨setValuesã§ãã‚‹ã‹è¦‹ã‚‹ãŸã‚ã€‚
  const testSheet = ss.getSheetByName("ãƒ†ã‚¹ãƒˆ");
  // testSheet.getRange(1,1,staffsData.length,staffsData[0].length).setValues(staffsData);ãƒ†ã‚¹ãƒˆã‚·ãƒ¼ãƒˆã§ä½¿ãˆã‚‹ã‚ˆ

  //â­ï¸ã‚¹ã‚¿ãƒƒãƒ•ã®å‹¤å‹™è¡¨æ ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ä½œæˆ
  const shiftMonthByStaffs = {};//1äººãšã¤ä¸€æœˆåˆ†ã®é…åˆ—ã‚’é€£æƒ³é…åˆ—ã«ã™ã‚‹
  staffsData.forEach(function ([_, name]) { //ã‚¹ã‚¿ãƒƒãƒ•åç°¿ã®2ã¤ç›®ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å€¤ã‚’
    shiftMonthByStaffs[name] = Array(eoMonth).fill(null); //ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã—ã¦ã€ãã‚Œãã‚Œã€æœˆã®æ—¥æ•°åˆ†å€¤ã‚’ç”¨æ„ã—ã¦nullã‚’å…¥ã‚Œã‚‹
  }); //log {æ¸…æ°´å’²è‰¯:[null, null, null,...],éˆ´æœ¨ç¿”å¤ª:[null, null, null,...],...} 


  //â­ï¸å¸Œæœ›ä¼‘ã‚’å…¥ã‚Œã‚‹
  const reqDayOff = {};
  //å¸Œæœ›ä¼‘ã‚·ãƒ¼ãƒˆã«ã‚ã‚‹ã‚¹ã‚¿ãƒƒãƒ•ã‚’ä¸€æ¬¡å…ƒé…åˆ—ã«
  const dayOffStaffs = dayOffSheet.getRange(6, 1, dayOffSheet.getLastRow() - 5, 1).getValues().flat();
  //å¸Œæœ›ä¼‘ã®äºŒæ¬¡å…ƒé…åˆ—
  const dayOffDatas = dayOffSheet.getRange(6, 3, dayOffStaffs.length, eoMonth).getValues();
  for (i = 0; i < dayOffStaffs.length; i++) {
    reqDayOff[dayOffStaffs[i]] = dayOffDatas[i]; //åå‰ã‚’ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€æ—¥ã«ã¡ã‚’å€¤ã¨ã™ã‚‹é€£æƒ³é…åˆ—ã«
  };
  for (name in reqDayOff) {//ã‚¹ã‚¿ãƒƒãƒ•ã‚·ãƒ•ãƒˆã®é€£æƒ³é…åˆ— ã¨ å¸Œæœ›ä¼‘ã®é€£æƒ³é…åˆ— ã®ãƒ«ãƒ¼ãƒ—
    const daysOff = reqDayOff[name];
    const shiftMonthByStaffsArr = shiftMonthByStaffs[name];
    //å¸Œæœ›ä¼‘ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ä½•ã‹å…¥åŠ›ã•ã‚Œã¦ã„ãŸã‚‰ã€ãã®ãƒ‡ãƒ¼ã‚¿ã‚’ä»£å…¥ã™ã‚‹
    for (let i = 0; i < daysOff.length; i++) {
      if (daysOff[i] != "") shiftMonthByStaffsArr[i] = daysOff[i];
    };
  };// shiftMonthByStaffs = {æ¸…æ°´å’²è‰¯:[null, "å¸Œ", null,...],éˆ´æœ¨ç¿”å¤ª:["æœ‰", null, null,...],...} 

  //â­ï¸â­ï¸æ—¥æ¯ã«ã‚·ãƒ•ãƒˆã‚’ä½œæˆã™ã‚‹
  for (let day = 0; day < eoMonth; day++) {//è©²å½“æœˆã®1æ—¥ã‹ã‚‰æœˆæœ«æ—¥ã¾ã§
    const nextDay = day + 1;
    const next2Day = day + 2;
    const prevDay = day - 1;
    const prev2Day = day - 2;
    //ä¼‘æ—¥æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦é…åˆ—ã«ã™ã‚‹
    const dayOffThisMonthArr = Object.entries(shiftMonthByStaffs)//ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…åˆ—ã«
      .map(([name, values]) => {  //åå‰ã¨ä¼‘æ—¥æ•°ã®è¦ç´ ã«
        const countDayOff = values.filter(v => dayOff.includes(v)).length;
        return [name, countDayOff];
      })//[[å‰ç”°è‰å­, 0.0], [ä½è—¤å¥å¤ª, 2.0], ...]
    //é–¢æ•°ï¼šã‚¹ã‚¿ãƒƒãƒ•åç°¿ã®é…åˆ—ã«ä¼‘æ—¥æ•°ã‚’pushã—ãŸé…åˆ—ã€€â†’ã€€ä¼‘æ—¥æ•°ãŒå¤šã„ã‚¹ã‚¿ãƒƒãƒ•é †ã«ã™ã‚‹
    function DayOffSort(job) {
      for (let i = 0; i < job.length; i++) {
        const a = job[i][namecol];//ã‚¹ã‚¿ãƒƒãƒ•åç°¿ã€€ã®æ°å
        for (let j = 0; j < dayOffThisMonthArr.length; j++) {
          const b = dayOffThisMonthArr[j][0];//ä¼‘æ—¥æ•°ã®é…åˆ—ã«ã‚ã‚‹ã€€æ°å
          const bCount = dayOffThisMonthArr[j][1];//ä¼‘æ—¥æ•°
          if (day == 0) {  //æœ€åˆã ã‘â€ä¼‘æ—¥æ•°â€ã®è¦ç´ ã‚’è¿½åŠ ã—ã¦ã‚ã¨ã¯ã€€â€ä¼‘æ—¥æ•°â€ã‚’æ›´æ–°ã—ã¦ã„ã
            if (a == b) job[i].push(bCount);
          } else {
            if (a == b) job[i][job[0].length - 1] = bCount;
          };
        };
      };
      job.sort((a, b) => {
        const diff = b[job[0].length - 1] - a[job[0].length - 1];
        if (diff != 0) return diff;
        return Math.random() - 0.5;
      });
      return job;

    };
    const sortedStaffs = DayOffSort(staffsData);

    //å¤œå‹¤ã‚’æ¤œè¨
    //ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ãŸã‚¹ã‚¿ãƒƒãƒ•ã®é…åˆ—ã®"åå‰"ã¨"é›‡ç”¨å½¢æ…‹"ã‚’ãƒ«ãƒ¼ãƒ—
    for (let [, name, , , , , , , job, type] of sortedStaffs) {//[]ã®ä¸­ã¯"ã‚¹ã‚¿ãƒƒãƒ•åç°¿"ã‚·ãƒ¼ãƒˆã®é †ç•ªã«å‰‡ã‚‹
      const shift = shiftMonthByStaffs[name];
      //å¤œå‹¤ã®ç¾åœ¨äººæ•°ã‚’æ•°ãˆã‚‹
      const numberOfNightStaffs = Object.values(shiftMonthByStaffs).filter(row => row[day] == yakin).length;
      //å¤œå‹¤ã®ç¾åœ¨ã®ã€€çœ‹è­·å¸«ä»¥å¤–ã€€ã®äººæ•°ã‚’æ•°ãˆã‚‹
      const numberOfNightOthers = staffsData.filter(staff => {
        const staffName = staff[namecol];
        const staffjob = staff[jobCol];
        return staffjob != nurseJob && shiftMonthByStaffs[staffName][day] == yakin;
      }).length;
      //å¤œå‹¤ã®ç¾åœ¨ã®ã€€çœ‹è­·å¸«ã€€ã®äººæ•°ã‚’æ•°ãˆã‚‹
      const numberOfNightnurses = staffsData.filter(staff => {
        const staffName = staff[namecol];
        const staffjob = staff[jobCol];
        return staffjob == nurseJob && shiftMonthByStaffs[staffName][day] == yakin;
      }).length;

      //å¿…è¦äººæ•°ã«é”ã—ã¦ã„ãŸã‚‰break
      if (numberOfNightStaffs >= requiredNightStaffs) break;
      //çœ‹è­·å¸«ã€€ã¨ã€€çœ‹è­·å¸«ä»¥å¤–ã€€ã®äººæ•°ãŒè¦å®šæ•°é…ç½®ã•ã‚Œã¦ã„ãŸã‚‰continue
      if (job == nurseJob && numberOfNightnurses >= requiredNightNurses) continue;
      if (job != nurseJob && numberOfNightOthers >= requiredNightStaffs - requiredNightNurses) continue;

      if (shift[day]) continue;  //ãã®æ—¥[day]ã«nullä»¥å¤–ãŒå…¥ã£ã¦ã„ãŸã‚‰continue
      if (type == onlyDayShift) continue; //é›‡ç”¨å½¢æ…‹ãŒæ—¥å‹¤å°‚å¾“ãªã‚‰continue
      const prevDay1shift = day > 0 ? shift[prevDay] : null; //å‰æ—¥ã®ã‚·ãƒ•ãƒˆ
      const prevDay2shift = day > 1 ? shift[prev2Day] : null; //å‰ã€…æ—¥ã®ã‚·ãƒ•ãƒˆ
      if ([prevDay1shift, prevDay2shift].includes(yakin)) continue; //å‰æ—¥ã¨å‰ã€…æ—¥ã«å¤œå‹¤ãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰continue

      //ç›´è¿‘ã®å¤œå‹¤ã‚·ãƒ•ãƒˆ
      const forNightShiftInterval = shift.slice(Math.max(0, day - nightShiftInterval), day)
      //ç›´è¿‘ã®å¤œå‹¤å›æ•°
      const nightShiftIntervalLength = forNightShiftInterval.filter(work => yakin.includes(work)).length
      //æŒ‡å®šã®æœŸé–“ã«å¤œå‹¤ãŒã‚ã‚Œã°continue
      if (nightShiftIntervalLength >= 1) continue;
      //ç›´è¿‘ã®ã€Œé€£å‹¤ä¸Šé™ã€æ—¥æ•°åˆ†ã®å‹¤å‹™str
      const previousDay = shift.slice(Math.max(0, day - continuousWork), day);
      //ãã®ã†ã¡ã®æ—¥å‹¤ã®æ•°
      const previousWorkCount = previousDay.filter(v => v == nikkin).length;
      //é€£å‹¤ä¸Šé™ã«é”ã—ã¦ã„ãŸã‚‰continue
      if (day > 0 && previousWorkCount == continuousWork) continue;

      //ä»Šæœˆã®ã€€ä¼‘æ—¥æ•°ã‚’æŠ½å‡º
      const dayOffThisMonth = shift.filter(off => dayOff.includes(off)).length;
      //ã€€ğŸ˜²æ€ªã—ã„!ã€€ä¼‘æ—¥æ—¥æ•°é”ã—ã¦ã„ã‚‹ãªã‚‰continue
      if (name == "æ¾æœ¬çµè¡£") Logger.log("day" + day);
      if (name == "æ¾æœ¬çµè¡£") Logger.log(name);
      if (name == "æ¾æœ¬çµè¡£") Logger.log("ä¼‘æš‡æ•° =" + dayOffThisMonth);
      if (name == "æ¾æœ¬çµè¡£") Logger.log(shift.filter(off => dayOff.includes(off)));

      if (dayOffThisMonth == monthlyDayOff) continue;

      if (next2Day < eoMonth) {
        if (shift[nextDay] == null && asatteyasumi.includes(shift[next2Day])) {
          shift[day] = yakin;//ä¸Šè¨˜ã®æ¡ä»¶(æ˜æ—¥ã€æ˜å¾Œæ—¥ãŒä¼‘æ—¥)ã‚’ã‚¯ãƒªã‚¢ã—ãŸäººã«å¤œå‹¤ã‚’å…¥ã‚Œã‚‹
          shift[nextDay] = ake;//å¤œå‹¤ã«ç¿Œæ—¥ã¯æ˜ã‘
          shift[next2Day] = akeyasu;//æ˜ã‘ã®æ¬¡ã®æ—¥ã¯å¿…ãšä¼‘ã¿ã«ãªã‚‹
        };
      } else if (next2Day == eoMonth) {
        if (shift[nextDay] == null) {
          shift[day] = yakin;
          shift[nextDay] = ake;//å¤œå‹¤ã«ç¿Œæ—¥ã¯æ˜ã‘
        };
      } else {
        shift[day] = yakin;
      }
      // };
    };

    //æ—¥å‹¤ã‚’æ¤œè¨   å¤œå‹¤ã¨ã®é•ã„ã¯ç¿Œæ—¥ã€ç¿Œã€…æ—¥ã«å‹¤å‹™æƒ…å ±ã‚’å…¥ã‚Œãªãã‚‚ã‚ˆã„ã¨ã“ã‚ã€‚
    for (let [, name, , , , , , , job, type] of sortedStaffs) {
      const shift = shiftMonthByStaffs[name];
      const numberOfDayStaffs = Object.values(shiftMonthByStaffs).filter(row => row[day] == nikkin).length;
      const numberOfDayOthers = staffsData.filter(staff => {
        const staffName = staff[namecol];
        const staffjob = staff[jobCol];
        return staffjob != nurseJob && shiftMonthByStaffs[staffName][day] == nikkin;
      }).length;
      const numberOfDaynurses = staffsData.filter(staff => {
        const staffName = staff[namecol];
        const staffjob = staff[jobCol];
        return staffjob == nurseJob && shiftMonthByStaffs[staffName][day] == nikkin;
      }).length;
      if (numberOfDayStaffs >= requiredDayStaffs) break;
      if (job == nurseJob && numberOfDaynurses >= requiredDayNurses) continue;
      if (job != nurseJob && numberOfDayOthers >= requiredDayStaffs - requiredDayNurses) continue;
      if (shift[day]) continue;
      if (type == onlyNightShift) continue; //å¤œå‹¤å°‚å¾“ãªã‚‰continue
      const prevDay1 = day > 0 ? shift[prevDay] : null;
      const prevDay2 = day > 1 ? shift[prev2Day] : null;
      if ([prevDay1, prevDay2].includes(yakin)) continue;

      const previousDay = shift.slice(Math.max(0, day - continuousWork), day);
      const previousWorkCount = previousDay.filter(v => v == nikkin).length;
      if (day > 0 && previousWorkCount == continuousWork) continue;
      const dayOffThisMonth = shift.filter(off => dayOff.includes(off)).length;
      if (dayOffThisMonth == monthlyDayOff) continue;
      shift[day] = nikkin;
      // };
    };
    //ã“ã“ã§å‹¤å‹™ãŒå½“ã¦ã¯ã¾ã‚‰ãªã‹ã£ãŸäººã¯"ä¼‘"ã¨ã™ã‚‹
    for (let name in shiftMonthByStaffs) {
      if (shiftMonthByStaffs[name][day] == null) shiftMonthByStaffs[name][day] = yasumi;
    };
  };

  //â­ï¸â­ï¸å®šå“¡ã«é”ã—ã¦ã„ãªã„æ—¥
  for (let name in shiftMonthByStaffs) {
    const shift = shiftMonthByStaffs[name];
    // ç¾åœ¨ã®ä¼‘ã¿æ•°ã‚’æ•°ãˆã‚‹
    let currentDaysOff = shift.filter(day => dayOff.includes(day)).length;
    // const type = staffsData.filter(col => col[namecol] == name).map(v => v[employeeTypeCol]);
    const type = staffsData.filter(col => col[namecol] == name).flat()[employeeTypeCol];

    // æŒ‡å®šã®å…¬ä¼‘æ•°ã‚ˆã‚Šå¤šã„å ´åˆ
    while (currentDaysOff > monthlyDayOff) {
      // å‹¤å‹™å¯èƒ½ãªæ—¥ï¼ˆç¾åœ¨"ä¼‘"ã«ãªã£ã¦ã„ã‚‹æ—¥ï¼‰ã‚’æ¢ã™

      let found = false;
      for (let day = 0; day < shift.length; day++) {

        if (shift[day] != yasumi) continue;//"ä¼‘"ã—ã‹æ¤œè¨ã—ãªã„
        const previousDay = shift.slice(Math.max(0, day - continuousWork), day);//ç›´è¿‘ã®ã€Œé€£å‹¤ä¸Šé™ã€æ—¥æ•°åˆ†ã®å‹¤å‹™str        
        const previousWorkCount = previousDay.filter(work => workday.includes(work)).length;
        if (day > 0 && previousWorkCount == continuousWork) continue;

        const nextDay = day + 1;
        const next2Day = day + 2;
        // ãã®æ—¥ã®å‹¤å‹™äººæ•°ã‚’æ•°ãˆã‚‹
        const dayWorkCount = Object.values(shiftMonthByStaffs).filter(row => row[day] == nikkin).length;
        const dayNightCount = Object.values(shiftMonthByStaffs).filter(row => row[day] == yakin).length;

        // å¤œå‹¤ã‚’æ¤œè¨  å¤œå‹¤ãŒè¶³ã‚Šã¦ã„ãªã„ & æ˜ã‘/æ¬¡ã®æ—¥ã«å‹¤å‹™ãŒãªã‘ã‚Œã°
        if (dayNightCount < requiredNightStaffs) {
          if (type == onlyDayShift) continue;
          // æ˜ã‘ãƒ»ä¼‘ã¿ã‚’å…¥ã‚Œã‚‹ä½™è£•ãŒã‚ã‚‹ã‹
          if (next2Day < eoMonth) {
            if (shift[nextDay] == yasumi && dayOffForYakin.includes(shift[next2Day])) {
              shift[day] = yakin;
              shift[nextDay] = ake;
              shift[next2Day] = akeyasu;
              currentDaysOff--;
              found = true;
              break;
            };
          } else if (next2Day == eoMonth) {
            if (shift[nextDay] == yasumi) {
              shift[day] = yakin;
              shift[nextDay] = ake;
              currentDaysOff--;
              found = true;
              break;
            };
          } else {
            shift[day] = yakin;
            currentDaysOff--;
            found = true;
            break;
          };
        };

        //æ—¥å‹¤æ¤œè¨ã€€ã¾ã æ—¥å‹¤äººæ•°ãŒè¶³ã‚Šã¦ã„ãªã„ãªã‚‰
        if (dayWorkCount < requiredDayStaffs) {
          if (type == onlyNightShift) continue;
          if (shift[day] == yasumi) {
            shift[day] = nikkin;
            currentDaysOff--;
            found = true;
            break;
          };
        }
      };

      // é©ã—ãŸå‹¤å‹™æ—¥ãŒãªã‘ã‚Œã° breakï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰
      if (!found) break;
    }
  }




  //â­ï¸â­ï¸ã‚‚ã†ä¸€åº¦
  for (let name in shiftMonthByStaffs) {

    const shift = shiftMonthByStaffs[name];

    const type = staffsData.filter(col => col[namecol] == name).flat()[employeeTypeCol];
    if (type == onlyNightShift) continue;

    let currentDaysOff = shift.filter(day => dayOff.includes(day)).length;

    while (currentDaysOff > monthlyDayOff) {
      let found = false;
      //æœˆé–“ã®å‹¤å‹™è€…æ•°ãŒå°‘ãªã„ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆé€£æƒ³é…åˆ—ã®é…åˆ—ï¼‰
      const workCount = [...Array(eoMonth)].fill(null).map((_, col) => ({
        index: col,
        values: Object.values(shiftMonthByStaffs).map(row => row[col]).filter(v => v == nikkin).length
      })).sort((a, b) => a.values - b.values);


      for (let { index } of workCount) {  //å‹¤å‹™è€…æ•°å°‘ãªã„æ—¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸Šä½ã‹ã‚‰ã¿ã¦ã„ã    

        if (shift[index] == yasumi) {
          shift[index] = nikkin;
          //ç¾åœ¨ã®indexæ—¥ã§ä»¥ä¸‹ã®foræ–‡ã§ä¸€åº¦ã§ã‚‚
          for (let i = 0; i < limitoverWorkDay; i++) {
            const recentDay = shift.slice(
              Math.max(0, index - continuousWork + i),
              Math.min(index + i + 1, eoMonth)
            );

            const recentDayWorkCount = recentDay.filter(work => workday.includes(work)).length;
            if (recentDayWorkCount >= limitoverWorkDay) {
              shift[index] = yasumi;
              break;
            }
          };
          //æ—¥å‹¤ãŒå…¥ã£ãŸã®ã§ç¾åœ¨ã®ä¼‘æ—¥æ•°ã‹ã‚‰1æ—¥å¼•ã
          if (shift[index] == nikkin) {
            currentDaysOff--;
            found = true;
          }
        };
        if (currentDaysOff <= monthlyDayOff) break;
      };
      if (!found) break;
    };
  };

  //â­ï¸ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è»¢è¨˜
  //ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«åãå‡ºã›ã‚‹æ§˜ã«äºŒæ¬¡å…ƒé…åˆ—ã«ç›´ã™
  const testArray = Object.entries(shiftMonthByStaffs).map(([name, shift]) => [name, ...shift]);
  //ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è»¢è¨˜
  testSheet.clear();
  testSheet.getRange(1, 1, testArray.length, testArray[0].length).setValues(testArray);

};
